<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agua Precipitable - UNALM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .header {
            background-color: #0C6854;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 13px;
            margin: 3px 0;
        }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
        }

        .back-btn {
            display: inline-block;
            background-color: #0C6854;
            color: white;
            padding: 8px 20px;
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .back-btn:hover {
            background-color: #084a3a;
        }

        .module-card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            border-left: 4px solid #0C6854;
            margin-bottom: 20px;
        }

        .module-card h2 {
            color: #0C6854;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .description {
            background: #f0f9f7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .formula-box {
            background: #e8f5f1;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .formula-box h3 {
            color: #0C6854;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #0C6854;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #084a3a;
            box-shadow: 0 0 5px rgba(12, 104, 84, 0.3);
        }

        .form-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 13px;
        }

        .btn-calculate {
            background-color: #0C6854;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .btn-calculate:hover {
            background-color: #084a3a;
        }

        .results {
            background: white;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #0C6854;
            margin-top: 25px;
            display: none;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results h3 {
            color: #0C6854;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .result-final {
            background: #0C6854;
            color: white;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            margin-top: 15px;
            font-size: 18px;
        }

        .result-final .value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .chart-container {
            margin-top: 30px;
            background: white;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #0C6854;
        }

        .chart-container h3 {
            color: #0C6854;
            margin-bottom: 20px;
            font-size: 20px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        .profiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            .module-card {
                padding: 20px;
            }

            .header h1 {
                font-size: 18px;
            }

            .header p {
                font-size: 12px;
            }

            .profiles-grid {
                grid-template-columns: 1fr;
            }

            .input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>Universidad Nacional Agraria La Molina</h1>
        <p>Maestr√≠a en Recursos H√≠dricos</p>
        <p>Curso: M√©todos de an√°lisis en ingenier√≠a de recursos h√≠dricos</p>
        <p>Docente: Dr. Eduardo Chavarri Velarde</p>
    </div>

    <!-- Contenido -->
    <div class="container">
        <a href="../index.html" class="back-btn">‚Üê Volver al Men√∫</a>

        <div class="module-card">
            <h2>üíß C√°lculo del Agua Precipitable</h2>
            
            <div class="description">
                <p>
                    El agua precipitable es la cantidad total de vapor de agua contenido en una columna 
                    de aire saturada. Se calcula estimando las presiones atmosf√©ricas en funci√≥n de las 
                    leyes del vapor de agua y presi√≥n hidrost√°tica a diferentes elevaciones.
                </p>
            </div>

            <div class="formula-box">
                <h3>üìê Datos de Entrada Requeridos</h3>
                <p>‚Ä¢ <strong>Altura total (m):</strong> Altura m√°xima de la columna de aire</p>
                <p>‚Ä¢ <strong>Alfa (¬∞C/km):</strong> Gradiente t√©rmico adiab√°tico</p>
                <p>‚Ä¢ <strong>Ra (J/kgK):</strong> Constante espec√≠fica del aire</p>
                <p>‚Ä¢ <strong>Temperatura (¬∞C):</strong> Temperatura del aire en la superficie</p>
                <p>‚Ä¢ <strong>N√∫mero de capas:</strong> Divisiones de la columna para el c√°lculo</p>
            </div>

            <!-- Formulario -->
            <form id="calculatorForm">
                <div class="input-grid">
                    <div class="form-group">
                        <label for="alturaTotal">Altura total (m):</label>
                        <input type="number" id="alturaTotal" step="1" value="10000" required>
                        <small>Altura m√°xima de la columna de aire</small>
                    </div>

                    <div class="form-group">
                        <label for="alfa">Alfa - Gradiente t√©rmico (¬∞C/km):</label>
                        <input type="number" id="alfa" step="0.1" value="6.5" required>
                        <small>T√≠picamente 6.5 ¬∞C/km</small>
                    </div>

                    <div class="form-group">
                        <label for="ra">Ra - Constante del aire (J/kgK):</label>
                        <input type="number" id="ra" step="0.1" value="287" required>
                        <small>Valor est√°ndar: 287 J/kgK</small>
                    </div>

                    <div class="form-group">
                        <label for="temperatura">Temperatura superficial (¬∞C):</label>
                        <input type="number" id="temperatura" step="0.1" value="30" required>
                        <small>Temperatura del aire al nivel del suelo</small>
                    </div>

                    <div class="form-group">
                        <label for="numCapas">N√∫mero de capas:</label>
                        <input type="number" id="numCapas" step="1" min="2" max="100" value="5" required>
                        <small>Divisiones de la columna (2-100)</small>
                    </div>
                </div>

                <button type="submit" class="btn-calculate">üî¨ Calcular Agua Precipitable</button>
            </form>
        </div>

        <!-- Resultados -->
        <div class="results" id="results">
            <h3>üìä C√°lculo del agua precipitable</h3>
            
            <!-- Tabla de resultados -->
            <div style="overflow-x: auto;">
                <table id="resultsTable" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                    <thead>
                        <tr style="background-color: #0C6854; color: white;">
                            <th style="padding: 12px; border: 1px solid #ddd;">Elevaci√≥n (Z)<br><small>km</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Temperatura<br><small>¬∞C</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Temperatura<br><small>¬∞K</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Presi√≥n del aire (p)<br><small>kPa</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Densidad (œÅa)<br><small>kg/m‚ÇÉ</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Presi√≥n de vapor (e)<br><small>kPa</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Humedad espec√≠fica (qv)<br><small>kg/kg</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Promedio sobre el momento<br>(qv medio)<br><small>kg/kg</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Densidad promedio (œÅa)<br><small>kg/m‚ÇÉ</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Masa incremental (Œîm)<br><small>kg</small></th>
                            <th style="padding: 12px; border: 1px solid #ddd;">Porcentaje de la masa total<br><small>%</small></th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Se llenar√° con JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr style="background-color: #f0f9f7; font-weight: bold;">
                            <td colspan="9" style="padding: 12px; border: 1px solid #ddd; text-align: right;">m<sub>n</sub></td>
                            <td style="padding: 12px; border: 1px solid #ddd; text-align: center;" id="totalMasa">-</td>
                            <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">100.0</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="result-final">
                <div>Agua Precipitable Total</div>
                <div class="value" id="aguaPrecipitable">-</div>
                <div>mm</div>
            </div>

            <!-- Explicaci√≥n de c√°lculos -->
            <div style="margin-top: 30px; padding: 25px; background: #f0f9f7; border-radius: 8px; border-left: 4px solid #0C6854;">
                <h3 style="color: #0C6854; margin-bottom: 20px; font-size: 18px;">üìã Metodolog√≠a de C√°lculo por Columnas</h3>
                
                <div style="line-height: 1.8;">
                    <p style="margin-bottom: 15px;"><strong>1. Elevaci√≥n (Z) [km]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        Z<sub>i</sub> = i √ó Œîh / 1000, donde Œîh = Altura total / N√∫mero de capas
                    </p>

                    <p style="margin-bottom: 15px;"><strong>2. Temperatura [¬∞C]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        T<sub>i</sub> = T<sub>i-1</sub> - Œ± √ó (Œîh / 1000)<br>
                        T<sub>0</sub> = Temperatura superficial
                    </p>

                    <p style="margin-bottom: 15px;"><strong>3. Temperatura [¬∞K]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        T(¬∞K) = T(¬∞C) + 273
                    </p>

                    <p style="margin-bottom: 15px;"><strong>4. Presi√≥n del aire (p) [kPa]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        p<sub>i</sub> = p<sub>i-1</sub> √ó (T<sub>i</sub> / T<sub>i-1</sub>)<sup>expo</sup><br>
                        donde: expo = 9.81 √ó 1000 / (Œ± √ó Ra)<br>
                        p<sub>0</sub> = 101.3 kPa
                    </p>

                    <p style="margin-bottom: 15px;"><strong>5. Densidad del aire (œÅa) [kg/m¬≥]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        œÅa = (p √ó 1000) / (Ra √ó T)<br>
                        donde: Ra = constante espec√≠fica del aire (J/kgK), T en ¬∞K
                    </p>

                    <p style="margin-bottom: 15px;"><strong>6. Presi√≥n de vapor (e) [kPa]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        e<sub>s</sub> = 0.61 √ó exp(17.27 √ó T / (237.3 + T))<br>
                        donde: T en ¬∞C (F√≥rmula de Magnus-Tetens)
                    </p>

                    <p style="margin-bottom: 15px;"><strong>7. Humedad espec√≠fica (q<sub>v</sub>) [kg/kg]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        q<sub>v</sub> = 0.622 √ó e / (p - 0.378 √ó e)
                    </p>

                    <p style="margin-bottom: 15px;"><strong>8. Promedio sobre el momento (q<sub>v</sub> medio) [kg/kg]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        q<sub>v medio,i</sub> = (q<sub>v,i-1</sub> + q<sub>v,i</sub>) / 2<br>
                        <em>Promedio entre la capa actual y la anterior</em>
                    </p>

                    <p style="margin-bottom: 15px;"><strong>9. Densidad promedio (œÅa medio) [kg/m¬≥]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        œÅa<sub>medio,i</sub> = (œÅa<sub>i-1</sub> + œÅa<sub>i</sub>) / 2<br>
                        <em>Promedio entre la capa actual y la anterior</em>
                    </p>

                    <p style="margin-bottom: 15px;"><strong>10. Masa incremental (Œîm) [kg]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        Œîm<sub>i</sub> = q<sub>v medio</sub> √ó œÅa<sub>medio</sub> √ó A √ó (z<sub>i</sub> - z<sub>i-1</sub>) √ó 1000<br>
                        donde: A = 1 m¬≤ (√°rea unitaria)<br>
                        <em>Se multiplica por 1000 porque z est√° en km</em>
                    </p>

                    <p style="margin-bottom: 15px;"><strong>11. Porcentaje de la masa total [%]:</strong></p>
                    <p style="margin-left: 20px; margin-bottom: 15px;">
                        % = (Œîm<sub>i</sub> / Œ£ Œîm) √ó 100<br>
                        donde: Œ£ Œîm = suma total de masas incrementales
                    </p>

                    <div style="margin-top: 25px; padding: 15px; background: white; border-radius: 5px; border: 2px solid #0C6854;">
                        <p style="color: #0C6854; font-weight: bold; margin-bottom: 10px;">üíß Agua Precipitable Total:</p>
                        <p style="margin-left: 20px;">
                            m<sub>n</sub> = Œ£ Œîm = suma de todas las masas incrementales [kg]<br>
                            <strong>Agua precipitable = m<sub>n</sub> mm</strong> (para √°rea unitaria de 1 m¬≤)
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gr√°ficos -->
        <div class="chart-container" id="chartsContainer" style="display: none;">
            <h3>üìà Perfiles Atmosf√©ricos</h3>
            <p style="color: #666; margin-bottom: 20px;">Los gr√°ficos est√°n en desarrollo y se habilitar√°n pr√≥ximamente.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        const form = document.getElementById('calculatorForm');
        const resultsDiv = document.getElementById('results');

        // Funci√≥n para calcular presi√≥n de vapor saturado (kPa)
        function Pr_vap_sat(T) {
            // T en ¬∞C
            // F√≥rmula: es = 0.61 * exp(17.27T / (237.3 + T))
            return 0.61 * Math.exp((17.27 * T) / (237.3 + T));
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            calcularAguaPrecipitable();
        });

        function calcularAguaPrecipitable() {
            // Obtener valores de entrada
            const alt_total = parseFloat(document.getElementById('alturaTotal').value);
            const alfa = parseFloat(document.getElementById('alfa').value);
            const Ra = parseFloat(document.getElementById('ra').value);
            const tem = parseFloat(document.getElementById('temperatura').value);
            const num_capas = parseInt(document.getElementById('numCapas').value);

            // Validaciones
            if (isNaN(alt_total) || isNaN(alfa) || isNaN(Ra) || isNaN(tem) || isNaN(num_capas)) {
                alert('Por favor ingrese valores num√©ricos v√°lidos');
                return;
            }

            if (num_capas < 2 || num_capas > 100) {
                alert('El n√∫mero de capas debe estar entre 2 y 100');
                return;
            }

            // Calcular incremento de altura por capa
            const delta_alt = alt_total / num_capas;

            // Arrays para almacenar resultados
            const npuntos = num_capas + 1;
            const elev = new Array(npuntos);      // Elevaci√≥n en m
            const elevKm = new Array(npuntos);    // Elevaci√≥n en km
            const tempC = new Array(npuntos);     // Temperatura en ¬∞C
            const tempK = new Array(npuntos);     // Temperatura en ¬∞K
            const p = new Array(npuntos);         // Presi√≥n del aire en kPa
            const den = new Array(npuntos);       // Densidad del aire en kg/m¬≥
            const es = new Array(npuntos);        // Presi√≥n de vapor en kPa
            const qh = new Array(npuntos);        // Humedad espec√≠fica en kg/kg

            // Inicializaci√≥n de la primera capa (superficie)
            elev[0] = 0;
            elevKm[0] = 0;
            tempC[0] = tem;
            tempK[0] = tem + 273;
            p[0] = 101.3;
            den[0] = 0;
            es[0] = 0;
            qh[0] = 0;

            // Exponente para la f√≥rmula de presi√≥n
            const expo = 9.81 * 1000 / (alfa * Ra);

            // C√°lculo iterativo para cada capa
            for (let i = 1; i < npuntos; i++) {
                // Elevaci√≥n
                elev[i] = i * delta_alt;
                elevKm[i] = elev[i] / 1000;

                // Temperatura disminuye con alfa (¬∞C/km)
                tempC[i] = tempC[i-1] - (alfa * delta_alt / 1000);
                tempK[i] = tempC[i] + 273;

                // Presi√≥n del aire usando f√≥rmula: p2 = p1 * (T2/T1)^expo
                p[i] = p[i-1] * Math.pow((tempK[i] / tempK[i-1]), expo);

                // Densidad del aire: œÅa = (p * 1000) / (Ra * T)
                den[i] = (p[i] * 1000) / (Ra * tempK[i]);

                // Presi√≥n de vapor saturado: es = 0.61 * exp(17.27T / (237.3 + T))
                es[i] = Pr_vap_sat(tempC[i]);

                // Humedad espec√≠fica: qv = 0.622 * e / (p - 0.378e)
                qh[i] = 0.622 * es[i] / (p[i] - 0.378 * es[i]);
            }

            // Calcular densidad para la primera capa
            den[0] = (p[0] * 1000) / (Ra * tempK[0]);
            es[0] = Pr_vap_sat(tempC[0]);
            qh[0] = 0.622 * es[0] / (p[0] - 0.378 * es[0]);

            // Llenar la tabla con los resultados
            llenarTabla(elevKm, tempC, tempK, p, den, es, qh);

            // Mostrar resultados
            resultsDiv.classList.add('show');

            // Crear gr√°ficos
            crearGraficos(elev, tempC, p, den, es, qh);

            // Mostrar contenedor de gr√°ficos
            chartsContainer.style.display = 'block';

            // Scroll suave a resultados
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Log para debugging
            console.log('=== AGUA PRECIPITABLE ===');
            console.log('Altura total:', alt_total, 'm');
            console.log('Alfa:', alfa, '¬∞C/km');
            console.log('Ra:', Ra, 'J/kgK');
            console.log('Temperatura superficie:', tem, '¬∞C');
            console.log('N√∫mero de capas:', num_capas);
            console.log('Delta altura por capa:', delta_alt, 'm');
            console.log('========================');
        }

        function llenarTabla(elevKm, tempC, tempK, p, den, es, qh) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            const npuntos = elevKm.length;
            const A = 1; // √Årea en m¬≤

            // Arrays para promedios y masa
            const qhMedio = new Array(npuntos);
            const denMedio = new Array(npuntos);
            const deltaMasa = new Array(npuntos);

            // La primera fila no tiene promedios ni masa incremental
            qhMedio[0] = null;
            denMedio[0] = null;
            deltaMasa[0] = null;

            // Calcular promedios y masa incremental entre capas consecutivas
            for (let i = 1; i < npuntos; i++) {
                qhMedio[i] = (qh[i-1] + qh[i]) / 2;
                denMedio[i] = (den[i-1] + den[i]) / 2;
                
                // Œîmi = qv ¬∑ œÅa ¬∑ A ¬∑ (zi - zi-1) ¬∑ 1000  (multiplicar por 1000 porque z est√° en km)
                deltaMasa[i] = qhMedio[i] * denMedio[i] * A * (elevKm[i] - elevKm[i-1]) * 1000;
            }

            // Calcular masa total
            let masaTotal = 0;
            for (let i = 1; i < npuntos; i++) {
                masaTotal += deltaMasa[i];
            }

            // Mostrar masa total en el pie de tabla
            document.getElementById('totalMasa').textContent = masaTotal.toFixed(1);

            // Mostrar agua precipitable (masa total en mm)
            document.getElementById('aguaPrecipitable').textContent = masaTotal.toFixed(2);

            // Calcular porcentajes
            const porcentajes = new Array(npuntos);
            porcentajes[0] = null;
            for (let i = 1; i < npuntos; i++) {
                porcentajes[i] = (deltaMasa[i] / masaTotal) * 100;
            }

            // Llenar la tabla
            for (let i = 0; i < npuntos; i++) {
                const row = document.createElement('tr');
                row.style.backgroundColor = i % 2 === 0 ? '#f9f9f9' : 'white';

                // Elevaci√≥n (km)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${elevKm[i].toFixed(1)}</td>`;
                
                // Temperatura (¬∞C)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${tempC[i].toFixed(1)}</td>`;
                
                // Temperatura (¬∞K)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${tempK[i].toFixed(1)}</td>`;
                
                // Presi√≥n del aire (kPa)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${p[i].toFixed(1)}</td>`;
                
                // Densidad (kg/m¬≥)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${den[i].toFixed(2)}</td>`;
                
                // Presi√≥n de vapor (kPa)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${es[i].toFixed(2)}</td>`;
                
                // Humedad espec√≠fica (kg/kg)
                row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${qh[i].toFixed(4)}</td>`;
                
                // qv medio (kg/kg)
                if (i === 0) {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center; background-color: #f0f0f0;">-</td>`;
                } else {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${qhMedio[i].toFixed(4)}</td>`;
                }
                
                // œÅa medio (kg/m¬≥)
                if (i === 0) {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center; background-color: #f0f0f0;">-</td>`;
                } else {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${denMedio[i].toFixed(2)}</td>`;
                }
                
                // Œîm (kg)
                if (i === 0) {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center; background-color: #f0f0f0;">-</td>`;
                } else {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${deltaMasa[i].toFixed(1)}</td>`;
                }
                
                // % masa total
                if (i === 0) {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center; background-color: #f0f0f0;">-</td>`;
                } else {
                    row.innerHTML += `<td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${porcentajes[i].toFixed(1)}</td>`;
                }

                tableBody.appendChild(row);
            }
        }

        let charts = {};

        function crearGraficos(elev, t, p, den, es, qh) {
            // Destruir gr√°ficos anteriores
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};

            // Convertir temperatura a ¬∞C para visualizaci√≥n
            const tCelsius = t.map(temp => temp - 273);

            // Configuraci√≥n com√∫n
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: { 
                        title: { display: true }
                    },
                    y: { 
                        title: { display: true, text: 'Elevaci√≥n (m)' }
                    }
                }
            };

            // Gr√°fico de Temperatura
            charts.temp = new Chart(document.getElementById('tempChart'), {
                type: 'line',
                data: {
                    labels: elev,
                    datasets: [{
                        label: 'Temperatura',
                        data: tCelsius,
                        borderColor: '#0C6854',
                        backgroundColor: 'rgba(12, 104, 84, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        x: { 
                            ...commonOptions.scales.x,
                            title: { display: true, text: 'Temperatura del aire (¬∞C)' }
                        }
                    },
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Perfil de la temperatura del aire'
                        }
                    }
                }
            });

            // Gr√°fico de Presi√≥n
            charts.presion = new Chart(document.getElementById('presionChart'), {
                type: 'line',
                data: {
                    labels: elev,
                    datasets: [{
                        label: 'Presi√≥n',
                        data: p,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        x: { 
                            ...commonOptions.scales.x,
                            title: { display: true, text: 'Presi√≥n atmosf√©rica (kPa)' }
                        }
                    },
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Perfil de la presi√≥n atmosf√©rica'
                        }
                    }
                }
            });

            // Gr√°fico de Densidad
            charts.densidad = new Chart(document.getElementById('densidadChart'), {
                type: 'line',
                data: {
                    labels: elev,
                    datasets: [{
                        label: 'Densidad',
                        data: den,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        x: { 
                            ...commonOptions.scales.x,
                            title: { display: true, text: 'Densidad del aire (kg/m¬≥)' }
                        }
                    },
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Perfil de la densidad del aire'
                        }
                    }
                }
            });

            // Gr√°fico de Presi√≥n de Vapor
            charts.vapor = new Chart(document.getElementById('vaporChart'), {
                type: 'line',
                data: {
                    labels: elev,
                    datasets: [{
                        label: 'Presi√≥n de vapor',
                        data: es,
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        x: { 
                            ...commonOptions.scales.x,
                            title: { display: true, text: 'Presi√≥n de vapor (kPa)' }
                        }
                    },
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Perfil de la presi√≥n de vapor'
                        }
                    }
                }
            });

            // Gr√°fico de Humedad Espec√≠fica
            charts.humedad = new Chart(document.getElementById('humedadChart'), {
                type: 'line',
                data: {
                    labels: elev,
                    datasets: [{
                        label: 'Humedad espec√≠fica',
                        data: qh,
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        x: { 
                            ...commonOptions.scales.x,
                            title: { display: true, text: 'Humedad espec√≠fica (kg/kg)' }
                        }
                    },
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Perfil de la humedad espec√≠fica'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>